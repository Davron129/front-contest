<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./src/assets/styles/global.css">
    <link rel="stylesheet" href="./src/assets/styles/test.css">
    <title>Home</title>
</head>
<body>
    <div class="wrapper">
        <aside class="sidebar">
            <div class="sidebar__logo">
                Logo
            </div>
            <nav class="sidebar__nav">
              <ul class="sidebar__menu">
                <li class="sidebar__item">
                    <a href="/home.html" class="sidebar__link">HOME</a>
                </li>
                <li class="sidebar__item">
                    <a href="/leaderboard.html" class="sidebar__link">LEADERBOARD</a>
                </li>
                <li class="sidebar__item">
                    <a href="/test.html" class="sidebar__link sidebar__link-active">TEST</a>
                </li>
                <li class="sidebar__item">
                    <a href="#" class="sidebar__link" id="logoutBtn">LOGOUT</a>
                </li>
            </ul>
            </nav>
        </aside>
        <main>
            <header class="header">
                <div class="header__info">
                    <div class="avatar">
                        <img src="./src/assets/img/kangaroo.png" alt="User avatar">
                    </div>
                    <div class="user__info" id="userInfo" ></div>
                </div>
            </header>

            <div class="main__wrapper">
                <h1 class="title mb-30">
                    Test
                </h1>

                <div class="timeframe">
                  <div class="icon">
                    <lord-icon
                      class="slow"
                      src="https://cdn.lordicon.com/ippkhukl.json"
                      trigger="loop"
                      style="width:80px;height:80px">
                    </lord-icon>
                    <lord-icon
                      class="medium"
                      src="https://cdn.lordicon.com/fvkdonkw.json"
                      trigger="loop"
                      style="width:80px;height:80px;opacity: 0;">
                    </lord-icon>
                    <lord-icon
                      class="fast"
                      src="https://cdn.lordicon.com/hovbgwmd.json"
                      trigger="loop"
                      style="width:80px;height:80px;opacity: 0;">
                    </lord-icon>
                  </div>
                  <div id="time_left">
                    <span>0</span>
                  </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <div class="card__title">Test</div>
                    </div>

                    <div class="card__body" id="testWrapper" >

                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="https://cdn.lordicon.com/ritcuqlt.js"></script>
    <script type="module">
        'use strict'
        import { isLogged, handleLogin, handleRegister, getQuestionsByLevel, handleLogout } from './src/scripts/test.js';
    
        const user = isLogged();
        const questions = getQuestionsByLevel("easy");
        const testWrapper = document.getElementById("testWrapper");
    
        const answers = questions.map(({ en, uz }) => ([
          {
            id: [en, uz].join(""),
            word: en
          },
          {
            id: [en, uz].join(""),
            word: uz
          },
        ]));
    
        const renderAnswers = answers.flat().map((answer) => (`
          <div class="answerBtn" data-id="${answer.id}" > ${answer.word} </div>
        `))
    
        testWrapper.addEventListener("click", (e) => {
          const selected = testWrapper.querySelector(".selected");

          if(selected === e.target) {
            selected.classList.remove('selected');
            return;
          }
    
          if(selected) {
            if(selected.getAttribute('data-id') === e.target.getAttribute('data-id')) {
              selected.classList.add('disabled');
              e.target.classList.add('disabled')
            }
            selected.classList.remove('selected')
          } else {
            e.target.classList.add('selected')
          }

          const disabledCount = testWrapper.querySelectorAll('.disabled').length;

          if(disabledCount === 20) {
            console.log("finish");
          }

        })
    
        if(testWrapper) {
          testWrapper.innerHTML = renderAnswers.join("")
        }
    
        const userInfo = document.getElementById('userInfo');
        userInfo.innerText = user.name;
        let time = 0;
        let int = setInterval(()=>{
          if(time == 2){
            document.querySelector(".icon .slow").style.opacity = 0;
            document.querySelector(".icon .medium").style.opacity = 1;
          } else if(time == 7){
            document.querySelector(".icon .medium").style.opacity = 0;
            document.querySelector(".icon .fast").style.opacity = 1;
          } else if(time == 12){
            document.querySelector(".icon .fast").style.opacity = 0;
            clearInterval(int);
            console.log("finish");
          }
          time ++;
          if (time < 13) {
            document.querySelector("#time_left span").textContent = time;
          }
        }, 1000)
    </script>
</body>
</html>